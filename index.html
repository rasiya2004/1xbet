<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1xBet Crash Game Real-Time Viewer</title>
<style>
  body { font-family: Arial, sans-serif; background: #0c0e2a; color: #0f0; padding: 20px; }
  #status { margin-bottom: 10px; }
  #output { white-space: pre-wrap; background: #111; padding: 10px; height: 300px; overflow-y: scroll; border-radius: 5px; border: 1px solid #0f0; }
  #prediction { margin-top: 15px; font-size: 1.2em; font-weight: bold; }
  button { margin-top: 10px; padding: 10px; border: none; border-radius: 5px; cursor: pointer; background: #0f0; color: #000; font-weight: bold; }
</style>
</head>
<body>
<h1>1xBet Crash Game Viewer & Predictor</h1>
<div id="status">Status: Disconnected</div>
<button id="connectBtn">Connect</button>
<button id="disconnectBtn" disabled>Disconnect</button>
<div id="output"></div>
<div id="prediction">Prediction: N/A</div>

<script>
(() => {
  const wsUrl = 'wss://1xbet.lk/games-frame/sockets/crash?ref=1&gr=911&whence=55&fcountry=208&appGuid=games-web-app-default-web-v3&lng=en&v=1.5)}&access_token=eyJhbGciOiJFUzI1NiIsImtpZCI6IjEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiI1MC8xMzY4OTcwMzk1IiwicGlkIjoiMSIsImp0aSI6IjAvNDllNDY4MzBiY2QyNTNiMTNkMGZkOGJmYzIxODk0ZDM3NDY0MDI5YmFkOTMwNzRiYmIzMTkzYjc3NDhiNzc0OCIsImFwcCI6Ik5BIiwiaW5uZXIiOiJ0cnVlIiwibmJmIjoxNzU4MjAxNzg4LCJleHAiOjE3NTgyMTYxODgsImlhdCI6MTc1ODIwMTc4OH0.iVqSy-a5TdEO3hm4_4RczgCV0SArgacAtAO80q7MjobD6uY6JhKf5OV05J95V-Oug0dax96tLXmtIUyppPtYyg';

  let ws = null;
  let dataHistory = [];

  const statusElem = document.getElementById('status');
  const outputElem = document.getElementById('output');
  const predictionElem = document.getElementById('prediction');
  const connectBtn = document.getElementById('connectBtn');
  const disconnectBtn = document.getElementById('disconnectBtn');

  function log(msg) {
    outputElem.textContent += msg + '\n';
    outputElem.scrollTop = outputElem.scrollHeight;
  }

  // Simple prediction: average last 5 values scaled randomly
  function predictNext(data) {
    if (data.length === 0) return 'N/A';
    const lastFive = data.slice(-5);
    const avg = lastFive.reduce((a,b) => a+b, 0) / lastFive.length;
    // Random small variation +/-15%
    const prediction = avg * (0.85 + Math.random()*0.3);
    return prediction.toFixed(2) + 'x';
  }

  function connect() {
    if (ws) return;

    ws = new WebSocket(wsUrl);

    statusElem.textContent = 'Status: Connecting...';
    connectBtn.disabled = true;
    disconnectBtn.disabled = false;

    ws.onopen = () => {
      statusElem.textContent = 'Status: Connected';
      log('WebSocket connected');
    };

    ws.onerror = err => {
      log('WebSocket error: ' + JSON.stringify(err));
      statusElem.textContent = 'Status: Error';
    };

    ws.onclose = () => {
      statusElem.textContent = 'Status: Disconnected';
      log('WebSocket disconnected');
      connectBtn.disabled = false;
      disconnectBtn.disabled = true;
      ws = null;
    };

    ws.onmessage = event => {
      log('Received: ' + event.data);

      // Attempt to parse meaningful multiplier value
      try {
        const parsed = JSON.parse(event.data);
        // Look for multiplier value in likely fields
        let multiplier = parsed.f || parsed.crash || parsed.multiplier || null;
        if (multiplier !== null) {
          multiplier = parseFloat(multiplier);
          if (!isNaN(multiplier)) {
            dataHistory.push(multiplier);
            predictionElem.textContent = 'Prediction: ' + predictNext(dataHistory);
          }
        }
      } catch(e) {
        // Ignore parsing errors on unexpected formats
      }
    };
  }

  function disconnect() {
    if (ws) {
      ws.close();
    }
  }

  connectBtn.addEventListener('click', connect);
  disconnectBtn.addEventListener('click', disconnect);
})();
</script>
</body>
</html>
